{% extends "base.html" %}
{% block title %}Search{% endblock %}
{% block nav_search %}active{% endblock %}

{% block content %}
<h1>Search</h1>

<div class="mb-16">
    <input type="text"
           class="form-control"
           placeholder="Search items, books, descriptions..."
           name="q"
           value="{{ vm.query }}"
           hx-get="/search/results"
           hx-target="#search-results"
           hx-trigger="keyup changed delay:300ms"
           hx-include="[name='room_id'],[name='category'],[name='condition'],[name='status']">
</div>

<div class="flex gap-8 mb-16 flex-wrap">
    <select name="room_id" class="form-control" style="width:auto"
            hx-get="/search/results" hx-target="#search-results" hx-include="[name='q'],[name='category'],[name='condition'],[name='status']">
        <option value="">All Rooms</option>
        {% for room in vm.rooms %}
        <option value="{{ room.id }}" {% if vm.room_id == room.id %}selected{% endif %}>{{ room.name }}</option>
        {% endfor %}
    </select>

    <select name="category" class="form-control" style="width:auto"
            hx-get="/search/results" hx-target="#search-results" hx-include="[name='q'],[name='room_id'],[name='condition'],[name='status']">
        <option value="">All Categories</option>
        {% for cat in ['electronics', 'furniture', 'kitchenware', 'books', 'clothing', 'tools', 'decor', 'appliances', 'sports', 'toys', 'other'] %}
        <option value="{{ cat }}" {% if vm.category == cat %}selected{% endif %}>{{ cat | capitalize }}</option>
        {% endfor %}
    </select>

    <select name="condition" class="form-control" style="width:auto"
            hx-get="/search/results" hx-target="#search-results" hx-include="[name='q'],[name='room_id'],[name='category'],[name='status']">
        <option value="">Any Condition</option>
        {% for c in ['new', 'good', 'fair', 'poor'] %}
        <option value="{{ c }}" {% if vm.condition == c %}selected{% endif %}>{{ c | capitalize }}</option>
        {% endfor %}
    </select>

    <select name="status" class="form-control" style="width:auto"
            hx-get="/search/results" hx-target="#search-results" hx-include="[name='q'],[name='room_id'],[name='category'],[name='condition']">
        <option value="">Any Status</option>
        {% for s in ['keep', 'sell', 'donate', 'trash'] %}
        <option value="{{ s }}" {% if vm.status == s %}selected{% endif %}>{{ s | capitalize }}</option>
        {% endfor %}
    </select>
</div>

<div id="search-results">
    {% if vm.results %}
    <p class="text-muted mb-8">{{ vm.total_results }} results</p>
    <div class="card-grid">
        {% for item in vm.results %}
        <a href="/items/{{ item.id }}" class="card">
            {% if item.thumbnail_path %}
            <img class="card-image" src="/static/images/{{ item.thumbnail_path | replace('data/images/', '') }}" alt="{{ item.name }}">
            {% else %}
            <div class="card-placeholder">?</div>
            {% endif %}
            <div class="card-title">{{ item.name }}</div>
            <div class="card-subtitle">{{ item.category }}</div>
        </a>
        {% endfor %}
    </div>
    {% elif vm.query %}
    <div class="empty-state">
        <p>No results for "{{ vm.query }}"</p>
    </div>
    {% else %}
    <div class="empty-state">
        <p>Start typing to search your inventory</p>
    </div>
    {% endif %}
</div>
{% endblock %}
